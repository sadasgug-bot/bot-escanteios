import logging
import sqlite3
import asyncio
from datetime import datetime
from telegram import Update
from telegram.ext import Application, CommandHandler, ContextTypes

# ConfiguraÃ§Ã£o
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

TOKEN = "8443274539:AAEZ_jfLKLAHjTquzS9Z650Xn4_-ZwTlrnI"

# Banco de dados em memÃ³ria (para Render)
usuarios = set()

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    usuarios.add(user_id)
    
    await update.message.reply_text(
        "ğŸ¤– *BOT 100% ONLINE - RENDER.COM* ğŸš€\n\n"
        "âœ… **Sistema 24/7 Ativado**\n"
        "ğŸ”” **Alertas AutomÃ¡ticos:** A cada 30min\n"
        "ğŸ¯ **EstratÃ©gia:** Odd 1.25 + Time pressionando\n\n"
        "âš¡ **Status:** Online sem computador\n"
        "ğŸ“± **Sempre disponÃ­vel no celular**\n\n"
        "Aguarde os primeiros alertas!",
        parse_mode='Markdown'
    )

async def teste(update: Update, context: ContextTypes.DEFAULT_TYPE):
    alerta = f"""
ğŸš¨ *ALERTA AUTOMÃTICO - {datetime.now().strftime("%H:%M")}* âš½

ğŸ† **Premier League - ONLINE**
âš½ **Arsenal 0Ã—1 Chelsea**
â° **Minuto:** 42'
ğŸ’° **Odd Betano:** 1.28 âœ…
ğŸ¯ **Aposta:** +3.5 escanteios

âœ… **Render.com:** 100% Online
âœ… **24/7:** Sem computador ligado
âœ… **AutomÃ¡tico:** Alertas a cada 30min

ğŸ”” *PrÃ³ximo alerta real em breve!*
"""
    await update.message.reply_text(alerta, parse_mode='Markdown')

async def alertas_automaticos(context: ContextTypes.DEFAULT_TYPE):
    try:
        logger.info("ğŸ” Procurando oportunidades...")
        
        # Simular alerta real
        alerta = f"""
ğŸš¨ *ALERTA ENCONTRADO!* âš½

ğŸ† **La Liga - {datetime.now().strftime("%d/%m %H:%M")}**
âš½ **Barcelona 1Ã—1 Real Madrid**
â° **Minuto:** 72'
ğŸ’° **Odd:** 1.31 âœ…
ğŸ¯ **+9.5 escanteios**

âœ… Time empatando pressionando
âœ… 8 escanteios totais
âœ… Odd acima de 1.25

âš¡ **Oportunidade vÃ¡lida por 15min**
"""
        
        # Enviar para todos usuÃ¡rios
        for user_id in list(usuarios):
            try:
                await context.bot.send_message(
                    chat_id=user_id,
                    text=alerta,
                    parse_mode='Markdown'
                )
                logger.info(f"âœ… Alerta enviado para {user_id}")
            except Exception as e:
                logger.error(f"âŒ Erro: {e}")
                
    except Exception as e:
        logger.error(f"âŒ Erro nos alertas: {e}")

def main():
    application = Application.builder().token(TOKEN).build()
    
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("teste", teste))
    
    # Alertas a cada 30 minutos
    job_queue = application.job_queue
    job_queue.run_repeating(alertas_automaticos, interval=1800, first=10)
    
    logger.info("ğŸš€ BOT 100% ONLINE INICIADO NO RENDER!")
    print("=" * 50)
    print("âœ… SISTEMA 24/7 CONFIGURADO!")
    print("ğŸ“ Render.com: Online permanente")
    print("ğŸ”” Alertas: A cada 30 minutos")
    print("ğŸ“± Telegram: @TirodeesquinaBot")
    print("=" * 50)
    
    application.run_polling()

if __name__ == '__main__':
    main()